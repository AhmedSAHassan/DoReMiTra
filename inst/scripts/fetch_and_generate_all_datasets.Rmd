---
title: "fetch_and_generate_all_datasets"
author: "Ahmed Hassan"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
editor_options: 
  chunk_output_type: console
---

# Loading required packages

```{r}
library(readxl)
library(GEOquery)
library(SummarizedExperiment)
library(dplyr)
library(S4Vectors)
library(stringr)
## TODOAHMED; is BIUMmisc really needed here? keep in mind it is not on CRAN so ppl would not find it
library(BIUMmisc)
library(matrixStats)
```

# Defining helper functions

## Fetching and generating summarized experiment objects for each dataset with rownames as gene symbols

```{r}
process_geo_dataset <- function(
    accession_id,
    excel_path,
    se_list = list(), # ðŸ†• the accumulating list of SE objects
    sheet = 1,
    accession_col = "Accession_no",
    author_col = "Author",
    year_col = "Year",
    setting_col = "Exp_Setting",
    possible_gene_cols = c("GENE_SYMBOL", "Gene.Symbol", "ILMN_Gene", "GeneSymbol")) {
  # Read metadata from Excel
  df <- readxl::read_excel(excel_path, sheet = sheet)
  idx <- which(trimws(df[[accession_col]]) == trimws(accession_id))
  if (length(idx) == 0) stop(sprintf("âŒ Accession %s not found in Excel.", accession_id))

  # Extract and sanitize naming components
  author_val <- ifelse(is.na(df[[author_col]][idx[1]]), "unknown", df[[author_col]][idx[1]])
  year_val <- ifelse(is.na(df[[year_col]][idx[1]]), "0000", as.character(df[[year_col]][idx[1]]))
  setting_val <- ifelse(is.na(df[[setting_col]][idx[1]]), "unspecified", df[[setting_col]][idx[1]])

  author <- gsub("[^A-Za-z0-9]", "_", trimws(author_val))
  year <- gsub("[^0-9]", "", year_val)
  setting <- gsub("[^A-Za-z0-9]", "_", trimws(setting_val))
  accession_clean <- gsub("[^A-Za-z0-9]", "", accession_id)
  base_prefix <- gsub("_+", "_", paste("SE", author, year, setting, accession_clean, sep = "_"))

  # Fetch GEO dataset(s)
  gse_list <- tryCatch(
    {
      GEOquery::getGEO(accession_id, GSEMatrix = TRUE)
    },
    error = function(e) stop(sprintf("âŒ GEO fetch failed: %s", e$message))
  )

  if (inherits(gse_list, "ExpressionSet")) {
    gse_list <- list(gse_list)
  }

  # Process each platform
  for (i in seq_along(gse_list)) {
    gse <- gse_list[[i]]
    platform <- annotation(gse)
    obj_name <- gsub("_+", "_", paste(base_prefix, platform, sep = "_"))

    message(sprintf("ðŸ”§ Processing %s", obj_name))

    se <- SummarizedExperiment::makeSummarizedExperimentFromExpressionSet(gse)
    rownames(se) <- rownames(Biobase::exprs(gse))

    # Extract and simplify
    counts <- SummarizedExperiment::assay(se)
    rd <- SummarizedExperiment::rowData(se)
    cd <- SummarizedExperiment::colData(se)

    # âœ… Add standardized empty metadata columns
    cd$Dose <- NA_character_
    cd$Time_point <- NA_character_
    cd$Sex <- NA_character_
    cd$Radiation_type <- NA_character_
    cd$Sample_id <- NA_character_
    cd$Organism <- NA_character_

    gene_symbol_col <- NULL
    for (col in possible_gene_cols) {
      if (col %in% colnames(rd)) {
        gene_symbol_col <- col
        break
      }
    }

    if (!is.null(gene_symbol_col)) {
      gene_symbols <- as.character(rd[[gene_symbol_col]])
      valid <- !is.na(gene_symbols) & gene_symbols != ""
      counts <- counts[valid, , drop = FALSE]
      gene_symbols <- gene_symbols[valid]
      rd <- rd[valid, , drop = FALSE]

      # Average expression per gene
      counts_sum <- rowsum(counts, group = gene_symbols)
      counts_n <- table(gene_symbols)
      counts_avg <- sweep(counts_sum, 1, counts_n, FUN = "/")
      rownames(counts_avg) <- rownames(counts_sum)

      rd_df <- as.data.frame(rd)
      rd_df$GENE_SYMBOL_AGG <- gene_symbols
      rd_agg_df <- dplyr::group_by(rd_df, GENE_SYMBOL_AGG) |>
        dplyr::slice(1) |>
        dplyr::ungroup()
      rd_agg_df$GENE_SYMBOL_AGG <- NULL
      rd <- S4Vectors::DataFrame(rd_agg_df)

      counts <- counts_avg
    } else {
      warning(sprintf("âš ï¸ No gene symbol column found for %s. Using probe-level IDs.", obj_name))
    }

    # Rebuild SE
    if (!all(colnames(counts) == rownames(cd))) stop("âŒ colnames(counts) â‰  rownames(colData)")
    if (!all(rownames(counts) == rownames(rd))) stop("âŒ rownames(counts) â‰  rownames(rowData)")

    final_se <- SummarizedExperiment::SummarizedExperiment(
      assays = list(counts = counts),
      rowData = rd,
      colData = cd
    )

    ## TODOAHMED: this is what I want to avoid... and basically "spit out" the se thing ONLY ;)
    # Add to the accumulating list
    se_list[[obj_name]] <- final_se
  }

  ## TODOAHMED - what I mean is: "hey, you even call it `final`", so for me this is what you return
  return(se_list)
}
```

## Exporting RDS files for each curated summarized experiment

```{r}
## TODOAHMED: as an idea: this function saves the SEs only, but it is called save_se_components
## what about having an extra parameter that can control this behavior? I will put some placeholders in
save_se_objects <- function(se_list, output_dir = ".",
                               save_se_obj = TRUE,
                               save_se_components = TRUE) {
  dir.create(output_dir, showWarnings = FALSE, recursive = TRUE)

  for (name in names(se_list)) {
    se <- se_list[[name]]
    
    if (save_se_obj) {
      output_file <- file.path(output_dir, paste0(name, ".RDS"))
      saveRDS(se, output_file)
      message(sprintf("ðŸ’¾ Saved: %s", basename(output_file)))
    }
    
    if (save_se_components) {
      ## TODOAHMED: uncomment and fill in here:
      output_file <- file.path(output_dir, paste0(name, ".RDS"))
      #### output_file_assays <- yadda
      #### output_file_rd <- yadda
      #### output_file_cd <- yadda
      #### saveRDS(assays(se), file = output_file_assays)
      #### saveRDS(rowData(se), file = output_file_rd)
      #### saveRDS(colData(se), file = output_file_cd)
      message(sprintf("ðŸ’¾ Saved individual components for: %s", basename(output_file)))
    }
  }
}

```


## Convert ENSEMBL id to gene symbol, remove NA, choose the highest variable gene symbol in case of genes with multiple ENSEMBL id, and add the resulting gene symbols as rownames

<!-- TODOAHMED: consider having a shorter title and putting the details in a bit of text component? -->

```{r}
collapse_by_symbol_variance <- function(se_object, symbol_col = "SYMBOL") {
  # Extract expression matrix and symbol
  counts <- assay(se_object)
  symbols <- as.character(rowData(se_object)[[symbol_col]])

  # Filter out missing symbols
  valid <- !is.na(symbols) & symbols != ""
  counts <- counts[valid, , drop = FALSE]
  symbols <- symbols[valid]
  row_data <- rowData(se_object)[valid, , drop = FALSE]

  # Compute row variances
  row_vars <- matrixStats::rowVars(as.matrix(counts))

  # Build a data.frame to track symbols and variance
  gene_df <- data.frame(
    idx = seq_along(symbols),
    symbol = symbols,
    variance = row_vars,
    stringsAsFactors = FALSE
  )

  # Select one row per symbol (highest variance)
  best_rows <- gene_df %>%
    group_by(symbol) %>%
    slice_max(variance, n = 1, with_ties = FALSE) %>%
    pull(idx)

  # Subset final components
  final_counts <- counts[best_rows, , drop = FALSE]
  final_rowData <- row_data[best_rows, , drop = FALSE]
  rownames(final_counts) <- symbols[best_rows]
  rownames(final_rowData) <- symbols[best_rows]

  # Build the final SE
  final_se <- SummarizedExperiment(
    ## TODOAHMED: consider calling this possibly something else, these are not truly counts..
    assays = list(counts = final_counts),
    rowData = final_rowData,
    colData = colData(se_object)
  )

  return(final_se)
}

```

# Fetching and generating the individual datasets

TODOAHMED: I am adding here the instance of the list of SEs, and later on the "updates to it".
Keep in mind I would still have the least interactions with the all_se_list itself, see the changes above...
Add a bit of "guidance"? "We first create an empty list object, where we will store the individual SE objects for the different studies we included in this scope."

```{r}
all_se_list <- list()
```

TODOAHMED: Here is also a good spot where you should say "actually, much of the metadata is in", but in a possibly messy way as everyone used a different wording, or a different column name. We will process the samples metadata for each study, with a special care for:

* the `Dose` of the radiation
* the `Radiation_type`
* the `Sex` of the samples included
* the `Time_point` of when the samples were collected (e.g. yadda hours after irradiation)
* the `Organism` where the measurements were performed
* the `Age` of the samples (of course, if reported)
* the `Sample_id`entifier, in order to have a fully standardized field for this
* the `TaxonomyId` according to the xxyy nomenclature
* the `Exp_setting`, where details are provided on the in vivo/in vitro nature of the study

TODOAHMED: if we have ALL this info (or most of it) encoded like this, it becomes fairly easy to jhave a "se-summary" to have an overview on each study - could be a nice function that tells a bit about the data "in a glance"?

## F&G se for gamma rays studies

### F&G GSE124612

TODOAHMED: I am changing this one as an example to have it as blueprint for the "things we need to change in the next ones"... please use a side-by-side diff to see the small-but-significant change (and do not hate me for this)

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE124612",
  excel_path = "inst/extdata/Curated_datasets.xlsx", 
  se_list = all_se_list
)

## TODOAHMED: this one is probably relevant only while you run it "live" but not needed in rendering (?)
## OTherwise: consider using the DT::datatable? View does not behave too nicely in knitting...
## Or possibly: do not run this in here, it could balloon up maybe?
colData(all_se_list$SE_Amundson_2019_vivo_GSE124612_GPL11202) |>
  as.data.frame() |>
  head()

## correcting coldata

# Dose
all_se_list$SE_Amundson_2019_vivo_GSE124612_GPL11202$Dose <- ifelse(
  grepl("control", all_se_list$SE_Amundson_2019_vivo_GSE124612_GPL11202$treatment.ch1, ignore.case = TRUE),
  "Control",
  str_replace_all(
    str_extract(
      all_se_list$SE_Amundson_2019_vivo_GSE124612_GPL11202$treatment.ch1,
      "\\d+(\\.\\d+)?\\s*Gy"
    ),
    "\\s+",
    ""
  )
)

# Radiation type
all_se_list$SE_Amundson_2019_vivo_GSE124612_GPL11202$Radiation_type <- rep("gamma ray", 248)

# Sex
all_se_list$SE_Amundson_2019_vivo_GSE124612_GPL11202$Sex <- str_to_title(all_se_list$SE_Amundson_2019_vivo_GSE124612_GPL11202$Sex.ch1)

# Time
all_se_list$SE_Amundson_2019_vivo_GSE124612_GPL11202$Time_point <- str_replace_all(
  str_extract(all_se_list$SE_Amundson_2019_vivo_GSE124612_GPL11202$treatment.ch1, "Day[_\\s]*\\d+"),
  "[_\\s]+", ""
)

# organism
all_se_list$SE_Amundson_2019_vivo_GSE124612_GPL11202$Organism <- all_se_list$SE_Amundson_2019_vivo_GSE124612_GPL11202$organism_ch1

# age
all_se_list$SE_Amundson_2019_vivo_GSE124612_GPL11202$Age <- all_se_list$SE_Amundson_2019_vivo_GSE124612_GPL11202$age.ch1

# sample id
all_se_list$SE_Amundson_2019_vivo_GSE124612_GPL11202$Sample_id <- colnames(all_se_list$SE_Amundson_2019_vivo_GSE124612_GPL11202)

# taxonomy id
all_se_list$SE_Amundson_2019_vivo_GSE124612_GPL11202$TaxonomyId <- all_se_list$SE_Amundson_2019_vivo_GSE124612_GPL11202$taxid_ch1 

# experimental setting
all_se_list$SE_Amundson_2019_vivo_GSE124612_GPL11202$Exp_setting <- rep("vivo", 248)

## TODOAHMED: to me, HERE is where we assign this to the list object
print(all_se_list$SE_Amundson_2019_vivo_GSE124612_GPL11202)
```

### F&G GSE104121

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE104121",
  excel_path = "inst/extdata/Curated_datasets.xlsx", all_se_list
)

colData(all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL10787) |>
  as.data.frame() |>
  head()


# working on platform GPL10787

# Sex

all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL10787$Sex <- str_to_title(all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL10787$gender.ch1)

# time

all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL10787$Time_point <- str_to_title(all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL10787$time.point.ch1)

all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL10787$Dose <- str_replace_all(
  str_extract(
    all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL10787$treatment.ch1,
    "\\d+(\\.\\d+)?\\s*Gy"
  ), "\\s+", ""
)

# radiation type

all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL10787$Radiation_type <- str_extract(all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL10787$treatment.ch1, "(gamma|x-ray|neutron|mixed)[\\s-]rays?")


# organism

all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL10787$Organism <- all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL10787$organism_ch1

# age

all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL10787$Age <- all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL10787$age.ch1

# sample id
all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL10787$Sample_id <- colnames(all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL10787)

# taxonomy id

all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL10787$TaxonomyId <- all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL10787$taxid_ch1 

# experimental setting

all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL10787$Exp_setting <- rep("vivo", 24)


# working on platform GPL21163

# Sex

all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL21163$Sex <- str_to_title(all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL21163$gender.ch1)

# time

all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL21163$Time_point <- str_to_title(all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL21163$time.point.ch1)

all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL21163$Dose <- str_replace_all(
  str_extract(
    all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL21163$treatment.ch1,
    "\\d+(\\.\\d+)?\\s*Gy"
  ), "\\s+", ""
)

# radiation type

all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL21163$Radiation_type <- str_extract(all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL21163$treatment.ch1, "(gamma|x-ray|neutron|mixed)[\\s-]rays?")

# organism

all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL21163$Organism <- all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL21163$organism_ch1

# age

all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL21163$Age <- all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL21163$age.ch1

# sample id
all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL21163$Sample_id <- colnames(all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL21163)

# taxonomy id

all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL21163$TaxonomyId <- all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL21163$taxid_ch1 

# experimental setting

all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL21163$Exp_setting <- rep("vivo", 24)


print(all_se_list$SE_Aryankalayil_2018_vivo_GSE104121_GPL21163)
```

### F&G GSE102971

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE102971",
  excel_path = "inst/extdata/Curated_datasets.xlsx", all_se_list
)

colData(all_se_list$SE_Park_2017_vitro_GSE102971_GPL10332) |>
  as.data.frame() |>
  head()

# Dose
all_se_list$SE_Park_2017_vitro_GSE102971_GPL10332$Dose <- all_se_list$SE_Park_2017_vitro_GSE102971_GPL10332$dose.ch1

# time
all_se_list$SE_Park_2017_vitro_GSE102971_GPL10332$Time_point <- rep("24h", 167)

# radiation type

all_se_list$SE_Park_2017_vitro_GSE102971_GPL10332$Radiation_type <- rep("gamma ray", 167)

# sex

all_se_list$SE_Park_2017_vitro_GSE102971_GPL10332$Sex <- all_se_list$SE_Park_2017_vitro_GSE102971_GPL10332$gender.ch1

# organism

all_se_list$SE_Park_2017_vitro_GSE102971_GPL10332$Organism <- all_se_list$SE_Park_2017_vitro_GSE102971_GPL10332$organism_ch1

# sample id
all_se_list$SE_Park_2017_vitro_GSE102971_GPL10332$Sample_id <- colnames(all_se_list$SE_Park_2017_vitro_GSE102971_GPL10332)

# taxonomy id

all_se_list$SE_Park_2017_vitro_GSE102971_GPL10332$TaxonomyId <- all_se_list$SE_Park_2017_vitro_GSE102971_GPL10332$taxid_ch1 

# experimental setting

all_se_list$SE_Park_2017_vitro_GSE102971_GPL10332$Exp_setting <- rep("vitro", 167)

print(all_se_list$SE_Park_2017_vitro_GSE102971_GPL10332)

```

### F&G GSE97000

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE97000",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)

colData(all_se_list$SE_Vasilyev_2017_vitro_GSE97000_GPL17077) |>
  as.data.frame() |>
  head()

# dose

all_se_list$SE_Vasilyev_2017_vitro_GSE97000_GPL17077$Dose <- ifelse(
  str_detect(all_se_list$SE_Vasilyev_2017_vitro_GSE97000_GPL17077$treatment.ch1, regex("control", ignore_case = TRUE)), "0Gy",
  str_replace_all(
    str_extract(all_se_list$SE_Vasilyev_2017_vitro_GSE97000_GPL17077$treatment.ch1, "\\d+(\\.\\d+)?\\s*Gy"), "\\s+", ""
  )
)

# time

all_se_list$SE_Vasilyev_2017_vitro_GSE97000_GPL17077$Time_point <- rep("24h", 12)

# radiation type

all_se_list$SE_Vasilyev_2017_vitro_GSE97000_GPL17077$Radiation_type <- rep("gamma ray", 12)

# sex
all_se_list$SE_Vasilyev_2017_vitro_GSE97000_GPL17077$Sex <- all_se_list$SE_Vasilyev_2017_vitro_GSE97000_GPL17077$gender.ch1

# age
all_se_list$SE_Vasilyev_2017_vitro_GSE97000_GPL17077$Age <- all_se_list$SE_Vasilyev_2017_vitro_GSE97000_GPL17077$age.ch1

# organism
all_se_list$SE_Vasilyev_2017_vitro_GSE97000_GPL17077$Organism <- all_se_list$SE_Vasilyev_2017_vitro_GSE97000_GPL17077$organism_ch1

# sample id
all_se_list$SE_Vasilyev_2017_vitro_GSE97000_GPL17077$Sample_id <- colnames(all_se_list$SE_Vasilyev_2017_vitro_GSE97000_GPL17077)

# taxonomy id

all_se_list$SE_Vasilyev_2017_vitro_GSE97000_GPL17077$TaxonomyId <- all_se_list$SE_Vasilyev_2017_vitro_GSE97000_GPL17077$taxid_ch1 

# experimental setting

all_se_list$SE_Vasilyev_2017_vitro_GSE97000_GPL17077$Exp_setting <- rep("vitro", 12)


print(all_se_list$SE_Vasilyev_2017_vitro_GSE97000_GPL17077)

```

### F&G GSE44201

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE44201",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)

# working on platform GPL6480

colData(all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6480) |>
  as.data.frame() |>
  head()

# Dose
all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6480$Dose <- all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6480$treatment.ch1
# radiation type
all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6480$Radiation_type <- rep("gamma ray", 25)

# time
all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6480$Time_point <- all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6480$time.ch1
# sex
all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6480$Sex <- all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6480$gender.ch1
# age
all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6480$Age <- all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6480$age.ch1
# organism
all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6480$Organism <- all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6480$organism_ch1

# sample id
all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6480$Sample_id <- colnames(all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6480)

# taxonomy id

all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6480$TaxonomyId <- all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6480$taxid_ch1 

# experimental setting

all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6480$Exp_setting <- rep("vitro", 25)


print(all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6480)


# working on platform GPL6848

colData(all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6848) |>
  as.data.frame() |>
  head()

# Dose
all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6848$Dose <- all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6848$treatment.ch1
# radiation type
all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6848$Radiation_type <- rep("gamma ray", 50)

# time
all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6848$Time_point <- all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6848$time.ch1
# sex
all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6848$Sex <- all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6848$gender.ch1
# age
all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6848$Age <- all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6848$age.ch1
# organism
all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6848$Organism <- all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6848$organism_ch1

# sample id
all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6848$Sample_id <- colnames(all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6848)

# taxonomy id

all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6848$TaxonomyId <- all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6848$taxid_ch1 

# experimental setting

all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6848$Exp_setting <- rep("vitro", 50)


print(all_se_list$SE_Paul_2013_vitro_GSE44201_GPL6848)

```

### F&G GSE43151

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE43151",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)

colData(all_se_list$SE_NOSEL_2013_vitro_GSE43151_GPL13497) |>
  as.data.frame() |>
  head()

# Dose
all_se_list$SE_NOSEL_2013_vitro_GSE43151_GPL13497$Dose <- ifelse(
  str_detect(all_se_list$SE_NOSEL_2013_vitro_GSE43151_GPL13497$source_name_ch1, regex("sham", ignore_case = TRUE)),
  "0Gy",
  paste0(as.numeric(str_extract(all_se_list$SE_NOSEL_2013_vitro_GSE43151_GPL13497$source_name_ch1, "\\d+(?=\\s*mGy)")) / 1000, "Gy")
)

# radiation type
all_se_list$SE_NOSEL_2013_vitro_GSE43151_GPL13497$Radiation_type <- rep("gamma ray", 121)

# time
all_se_list$SE_NOSEL_2013_vitro_GSE43151_GPL13497$Time_point <- str_extract(all_se_list$SE_NOSEL_2013_vitro_GSE43151_GPL13497$source_name_ch1, "\\d+\\s*min") |> str_replace_all("\\s+", "")


# sex
all_se_list$SE_NOSEL_2013_vitro_GSE43151_GPL13497$Sex <- all_se_list$SE_NOSEL_2013_vitro_GSE43151_GPL13497$gender.ch1

# organism
all_se_list$SE_NOSEL_2013_vitro_GSE43151_GPL13497$Organism <- all_se_list$SE_NOSEL_2013_vitro_GSE43151_GPL13497$organism_ch1

# sample id
all_se_list$SE_NOSEL_2013_vitro_GSE43151_GPL13497$Sample_id <- colnames(all_se_list$SE_NOSEL_2013_vitro_GSE43151_GPL13497)


# taxonomy id

all_se_list$SE_NOSEL_2013_vitro_GSE43151_GPL13497$TaxonomyId <- all_se_list$SE_NOSEL_2013_vitro_GSE43151_GPL13497$taxid_ch1 

# experimental setting

all_se_list$SE_NOSEL_2013_vitro_GSE43151_GPL13497$Exp_setting <- rep("vitro", 121)


print(all_se_list$SE_NOSEL_2013_vitro_GSE43151_GPL13497)
```

### F&G GSE20173

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE20173",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)


# keep is for later... this dataset structure is messy.. the information on GEO doesn't match the info from the publication


colData(all_se_list$SE_Girardi_2012_vitro_GSE20173_GPL6480) |>
  as.data.frame() |>
  head()

# there is no informatio about the sex here

treatments <- all_se_list$SE_Girardi_2012_vitro_GSE20173_GPL6480$treatment.ch1

# Create clean labels
Treatment_clean <- case_when(
  str_detect(treatments, "irradiated.*gamma.*parallel ground") ~ "2Gy-parallel_ground_conditions",
  str_detect(treatments, "irradiated.*gamma.*modelled microgravity") ~ "2Gy-modelled_microgravity",
  str_detect(treatments, regex("modelled|modeled microgravity", ignore_case = TRUE)) ~ "Control-modelled_microgravity",
  str_detect(treatments, "1g condition") ~ "Control-parallel_ground_conditions",
  TRUE ~ "unknown"
)

# dose

all_se_list$SE_Girardi_2012_vitro_GSE20173_GPL6480$Dose <- Treatment_clean

# time
all_se_list$SE_Girardi_2012_vitro_GSE20173_GPL6480$Time_point <- rep("24hr", 20)

# radiation
all_se_list$SE_Girardi_2012_vitro_GSE20173_GPL6480$Radiation_type <- rep("gamma ray", 20)

# organism

all_se_list$SE_Girardi_2012_vitro_GSE20173_GPL6480$Organism <- all_se_list$SE_Girardi_2012_vitro_GSE20173_GPL6480$organism_ch1

# sample id

all_se_list$SE_Girardi_2012_vitro_GSE20173_GPL6480$Sample_id <- colnames(all_se_list$SE_Girardi_2012_vitro_GSE20173_GPL6480)

# taxonomy id

all_se_list$SE_Girardi_2012_vitro_GSE20173_GPL6480$TaxonomyId <- all_se_list$SE_Girardi_2012_vitro_GSE20173_GPL6480$taxid_ch1 

# experimental setting

all_se_list$SE_Girardi_2012_vitro_GSE20173_GPL6480$Exp_setting <- rep("vitro", 20)


print(all_se_list$SE_Girardi_2012_vitro_GSE20173_GPL6480)
```

### F&G GSE23515

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE23515",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)

colData(all_se_list$SE_Amundson_2011_vitro_GSE23515_GPL6480) |>
  as.data.frame() |>
  head()


# Dose
all_se_list$SE_Amundson_2011_vitro_GSE23515_GPL6480$Dose <- all_se_list$SE_Amundson_2011_vitro_GSE23515_GPL6480$radiation.dose.ch1

# radiation type
all_se_list$SE_Amundson_2011_vitro_GSE23515_GPL6480$Radiation_type <- rep("gamma ray", 95)

# time
all_se_list$SE_Amundson_2011_vitro_GSE23515_GPL6480$Time_point <- rep("6hr", 95)
# sex
all_se_list$SE_Amundson_2011_vitro_GSE23515_GPL6480$Sex <- all_se_list$SE_Amundson_2011_vitro_GSE23515_GPL6480$gender.ch1

# age

all_se_list$SE_Amundson_2011_vitro_GSE23515_GPL6480$Age <- all_se_list$SE_Amundson_2011_vitro_GSE23515_GPL6480$age.ch1

# organism
all_se_list$SE_Amundson_2011_vitro_GSE23515_GPL6480$Organism <- all_se_list$SE_Amundson_2011_vitro_GSE23515_GPL6480$organism_ch1

# sample id
all_se_list$SE_Amundson_2011_vitro_GSE23515_GPL6480$Sample_id <- colnames(all_se_list$SE_Amundson_2011_vitro_GSE23515_GPL6480)

# smoking status

all_se_list$SE_Amundson_2011_vitro_GSE23515_GPL6480$Smoking_status <- all_se_list$SE_Amundson_2011_vitro_GSE23515_GPL6480$smoking.status.ch1

# taxonomy id

all_se_list$SE_Amundson_2011_vitro_GSE23515_GPL6480$TaxonomyId <- all_se_list$SE_Amundson_2011_vitro_GSE23515_GPL6480$taxid_ch1 

# experimental setting

all_se_list$SE_Amundson_2011_vitro_GSE23515_GPL6480$Exp_setting <- rep("vitro", 95)


print(all_se_list$SE_Amundson_2011_vitro_GSE23515_GPL6480)
```

### F&G GSE6978

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE6978",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)

colData(all_se_list$SE_GRUEL_2008_vitro_GSE6978_GPL4803) |>
  as.data.frame() |>
  head()

# Dose
all_se_list$SE_GRUEL_2008_vitro_GSE6978_GPL4803$Dose <- str_extract(all_se_list$SE_GRUEL_2008_vitro_GSE6978_GPL4803$title, "\\d+(\\.\\d+)?Gy")

# radiation type
all_se_list$SE_GRUEL_2008_vitro_GSE6978_GPL4803$Radiation_type <- rep("gamma ray", 114)

# time
all_se_list$SE_GRUEL_2008_vitro_GSE6978_GPL4803$Time_point <- str_extract(all_se_list$SE_GRUEL_2008_vitro_GSE6978_GPL4803$title, "\\d+h") |> str_replace("h", "hr")
# sex
all_se_list$SE_GRUEL_2008_vitro_GSE6978_GPL4803$Sex <- rep("male", 114)

# organism
all_se_list$SE_GRUEL_2008_vitro_GSE6978_GPL4803$Organism <- all_se_list$SE_GRUEL_2008_vitro_GSE6978_GPL4803$organism_ch1

# sample id
all_se_list$SE_GRUEL_2008_vitro_GSE6978_GPL4803$Sample_id <- colnames(all_se_list$SE_GRUEL_2008_vitro_GSE6978_GPL4803)

# cell type
all_se_list$SE_GRUEL_2008_vitro_GSE6978_GPL4803$Cell_type <- str_extract(all_se_list$SE_GRUEL_2008_vitro_GSE6978_GPL4803$title, "^[^_]+")

# taxonomy id

all_se_list$SE_GRUEL_2008_vitro_GSE6978_GPL4803$TaxonomyId <- all_se_list$SE_GRUEL_2008_vitro_GSE6978_GPL4803$taxid_ch1 

# experimental setting

all_se_list$SE_GRUEL_2008_vitro_GSE6978_GPL4803$Exp_setting <- rep("vitro", 114)

print(all_se_list$SE_GRUEL_2008_vitro_GSE6978_GPL4803)

```

### F&G GSE63952

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE63952",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)

colData(all_se_list$SE_Rouchka_2019_vitro_GSE63952_GPL15207) |>
  as.data.frame() |>
  head()

# there is no information about sex

# dose ... there is a space between the dose and the unit

all_se_list$SE_Rouchka_2019_vitro_GSE63952_GPL15207$Dose <- all_se_list$SE_Rouchka_2019_vitro_GSE63952_GPL15207$radiation.dose.ch1

# time

all_se_list$SE_Rouchka_2019_vitro_GSE63952_GPL15207$Time_point <- all_se_list$SE_Rouchka_2019_vitro_GSE63952_GPL15207$time.ch1

# radiation type

all_se_list$SE_Rouchka_2019_vitro_GSE63952_GPL15207$Radiation_type <- rep("gamma ray", 100)

# organism

all_se_list$SE_Rouchka_2019_vitro_GSE63952_GPL15207$Organism <- all_se_list$SE_Rouchka_2019_vitro_GSE63952_GPL15207$organism_ch1

# sex ... it is not mentioned on GEO or in the publication

all_se_list$SE_Rouchka_2019_vitro_GSE63952_GPL15207$Sex <- NA

# sample id

all_se_list$SE_Rouchka_2019_vitro_GSE63952_GPL15207$Sample_id <- colnames(all_se_list$SE_Rouchka_2019_vitro_GSE63952_GPL15207)

# taxonomy id

all_se_list$SE_Rouchka_2019_vitro_GSE63952_GPL15207$TaxonomyId <- all_se_list$SE_Rouchka_2019_vitro_GSE63952_GPL15207$taxid_ch1 

# experimental setting

all_se_list$SE_Rouchka_2019_vitro_GSE63952_GPL15207$Exp_setting <- rep("vitro", 100)


print(all_se_list$SE_Rouchka_2019_vitro_GSE63952_GPL15207)
```

### F&G GSE8917

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE8917",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)

colData(all_se_list$SE_Amundson_2008_vitro_GSE8917_GPL1708) |>
  as.data.frame() |>
  head()

# dose

all_se_list$SE_Amundson_2008_vitro_GSE8917_GPL1708$Dose <- str_extract(all_se_list$SE_Amundson_2008_vitro_GSE8917_GPL1708$title, "\\d+(\\.\\d+)?Gy")

# time
all_se_list$SE_Amundson_2008_vitro_GSE8917_GPL1708$Time_point <- str_extract(all_se_list$SE_Amundson_2008_vitro_GSE8917_GPL1708$title, "\\d+hr")

# radiaation
all_se_list$SE_Amundson_2008_vitro_GSE8917_GPL1708$Radiation_type <- rep("gamma ray", 50)

# sex
all_se_list$SE_Amundson_2008_vitro_GSE8917_GPL1708$Sex <- all_se_list$SE_Amundson_2008_vitro_GSE8917_GPL1708$Gender.ch1

# organism
all_se_list$SE_Amundson_2008_vitro_GSE8917_GPL1708$Organism <- all_se_list$SE_Amundson_2008_vitro_GSE8917_GPL1708$organism_ch1

# age
all_se_list$SE_Amundson_2008_vitro_GSE8917_GPL1708$Age <- all_se_list$SE_Amundson_2008_vitro_GSE8917_GPL1708$Age.ch1

# sample id
all_se_list$SE_Amundson_2008_vitro_GSE8917_GPL1708$Sample_id <- colnames(all_se_list$SE_Amundson_2008_vitro_GSE8917_GPL1708)

# taxonomy id

all_se_list$SE_Amundson_2008_vitro_GSE8917_GPL1708$TaxonomyId <- all_se_list$SE_Amundson_2008_vitro_GSE8917_GPL1708$taxid_ch1 

# experimental setting

all_se_list$SE_Amundson_2008_vitro_GSE8917_GPL1708$Exp_setting <- rep("vitro", 50)


print(all_se_list$SE_Amundson_2008_vitro_GSE8917_GPL1708)

```

### F&G GSE36355

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE36355",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)

colData(all_se_list$SE_MANIKANDAN_2014_vitro_GSE36355_GPL6883) |>
  as.data.frame() |>
  head()

# there is no info about sex

# dose
all_se_list$SE_MANIKANDAN_2014_vitro_GSE36355_GPL6883$Dose <- rep(c("0Gy", "1Gy"), 8)

# time
all_se_list$SE_MANIKANDAN_2014_vitro_GSE36355_GPL6883$Time_point <- rep("30min", 16)

# radiation
all_se_list$SE_MANIKANDAN_2014_vitro_GSE36355_GPL6883$Radiation_type <- rep("gamma ray", 16)

# cell type
all_se_list$SE_MANIKANDAN_2014_vitro_GSE36355_GPL6883$Cell_type <- all_se_list$SE_MANIKANDAN_2014_vitro_GSE36355_GPL6883$cell.type.ch1

# organism

all_se_list$SE_MANIKANDAN_2014_vitro_GSE36355_GPL6883$Organism <- all_se_list$SE_MANIKANDAN_2014_vitro_GSE36355_GPL6883$organism_ch1

# sample id

all_se_list$SE_MANIKANDAN_2014_vitro_GSE36355_GPL6883$Sample_id <- colnames(all_se_list$SE_MANIKANDAN_2014_vitro_GSE36355_GPL6883)

# taxonomy id

all_se_list$SE_MANIKANDAN_2014_vitro_GSE36355_GPL6883$TaxonomyId <- all_se_list$SE_MANIKANDAN_2014_vitro_GSE36355_GPL6883$taxid_ch1 

# experimental setting

all_se_list$SE_MANIKANDAN_2014_vitro_GSE36355_GPL6883$Exp_setting <- rep("vitro", 16)


print(all_se_list$SE_MANIKANDAN_2014_vitro_GSE36355_GPL6883)

```

### F&G GSE44245

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE44245",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)

colData(all_se_list$SE_Lee_2013_vitro_GSE44245_GPL570) |>
  as.data.frame() |>
  head()

# there is no info about sex here

# dose

all_se_list$SE_Lee_2013_vitro_GSE44245_GPL570$Dose <- c(rep("0Gy", 3), rep("5Gy", 3))

# time

all_se_list$SE_Lee_2013_vitro_GSE44245_GPL570$Time_point <- rep("24hr", 6)

# radiation
all_se_list$SE_Lee_2013_vitro_GSE44245_GPL570$Radiation_type <- rep("gamma ray", 6)

# organism

all_se_list$SE_Lee_2013_vitro_GSE44245_GPL570$Organism <- all_se_list$SE_Lee_2013_vitro_GSE44245_GPL570$organism_ch1

# sample id

all_se_list$SE_Lee_2013_vitro_GSE44245_GPL570$Sample_id <- colnames(all_se_list$SE_Lee_2013_vitro_GSE44245_GPL570)

# taxonomy id

all_se_list$SE_Lee_2013_vitro_GSE44245_GPL570$TaxonomyId <- all_se_list$SE_Lee_2013_vitro_GSE44245_GPL570$taxid_ch1 

# experimental setting

all_se_list$SE_Lee_2013_vitro_GSE44245_GPL570$Exp_setting <- rep("vitro", 6)


print(all_se_list$SE_Lee_2013_vitro_GSE44245_GPL570)

```

### F&G GSE64375

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE64375",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)

# gene symbol in this dataset is not extractable

colData(all_se_list$SE_Rouchka_2015_vitro_GSE64375_GPL6244) |>
  as.data.frame() |>
  head()

# there is no info about sex here

# dose
all_se_list$SE_Rouchka_2015_vitro_GSE64375_GPL6244$Dose <- all_se_list$SE_Rouchka_2015_vitro_GSE64375_GPL6244$radiation.dose.ch1

# time

all_se_list$SE_Rouchka_2015_vitro_GSE64375_GPL6244$Time_point <- all_se_list$SE_Rouchka_2015_vitro_GSE64375_GPL6244$time.ch1

# radiation
all_se_list$SE_Rouchka_2015_vitro_GSE64375_GPL6244$Radiation_type <- rep("gamma ray", 16)

# organism

all_se_list$SE_Rouchka_2015_vitro_GSE64375_GPL6244$Organism <- all_se_list$SE_Rouchka_2015_vitro_GSE64375_GPL6244$organism_ch1

# sample id
all_se_list$SE_Rouchka_2015_vitro_GSE64375_GPL6244$Sample_id <- colnames(all_se_list$SE_Rouchka_2015_vitro_GSE64375_GPL6244)

# taxonomy id

all_se_list$SE_Rouchka_2015_vitro_GSE64375_GPL6244$TaxonomyId <- all_se_list$SE_Rouchka_2015_vitro_GSE64375_GPL6244$taxid_ch1 

# experimental setting

all_se_list$SE_Rouchka_2015_vitro_GSE64375_GPL6244$Exp_setting <- rep("vitro", 16)


print(all_se_list$SE_Rouchka_2015_vitro_GSE64375_GPL6244)
```

### F&G GSE55953

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE55953",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)

colData(all_se_list$SE_Ankermit_2015_vitro_GSE55953_GPL14550) |>
  as.data.frame() |>
  head()

# dose
all_se_list$SE_Ankermit_2015_vitro_GSE55953_GPL14550$Dose <- rep(c("0Gy", "60Gy", "0Gy", "60Gy", "0Gy", "60Gy", "0Gy"), each = 4)

# time
all_se_list$SE_Ankermit_2015_vitro_GSE55953_GPL14550$Time_point <- all_se_list$SE_Ankermit_2015_vitro_GSE55953_GPL14550$time.ch1

# radiation
all_se_list$SE_Ankermit_2015_vitro_GSE55953_GPL14550$Radiation_type <- rep("gamma ray", 28)

# sex
all_se_list$SE_Ankermit_2015_vitro_GSE55953_GPL14550$Sex <- rep("male", 28)

# organism

all_se_list$SE_Ankermit_2015_vitro_GSE55953_GPL14550$Organism <- all_se_list$SE_Ankermit_2015_vitro_GSE55953_GPL14550$organism_ch1

# sample id
all_se_list$SE_Ankermit_2015_vitro_GSE55953_GPL14550$Sample_id <- colnames(all_se_list$SE_Ankermit_2015_vitro_GSE55953_GPL14550)

# taxonomy id

all_se_list$SE_Ankermit_2015_vitro_GSE55953_GPL14550$TaxonomyId <- all_se_list$SE_Ankermit_2015_vitro_GSE55953_GPL14550$taxid_ch1 

# experimental setting

all_se_list$SE_Ankermit_2015_vitro_GSE55953_GPL14550$Exp_setting <- rep("vitro", 28)

print(all_se_list$SE_Ankermit_2015_vitro_GSE55953_GPL14550)

```

## F&G se for neutron studies

### F&G GSE113509

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE113509",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)


colData(all_se_list$SE_Broustas_2018_vivo_GSE113509_GPL11202) |>
  as.data.frame() |>
  head()

# remove samples with mixed field irradiation

all_se_list$SE_Broustas_2018_vivo_GSE113509_GPL11202 <- all_se_list$SE_Broustas_2018_vivo_GSE113509_GPL11202[, -c(13:30)]

# dose

all_se_list$SE_Broustas_2018_vivo_GSE113509_GPL11202$Dose <- ifelse(
  str_detect(all_se_list$SE_Broustas_2018_vivo_GSE113509_GPL11202$treatment.ch1, regex("none", ignore_case = TRUE)), "0Gy", str_remove_all(str_extract(all_se_list$SE_Broustas_2018_vivo_GSE113509_GPL11202$treatment.ch1, "\\d+(\\.\\d+)?\\s*Gy"), "\\s+")
)

# time

all_se_list$SE_Broustas_2018_vivo_GSE113509_GPL11202$Time_point <- rep("7 days", 18)

# radiation
all_se_list$SE_Broustas_2018_vivo_GSE113509_GPL11202$Radiation_type <- ifelse(
  str_detect(all_se_list$SE_Broustas_2018_vivo_GSE113509_GPL11202$treatment.ch1, regex("none", ignore_case = TRUE)),
  "control",
  str_extract(all_se_list$SE_Broustas_2018_vivo_GSE113509_GPL11202$treatment.ch1, "(x-ray|neutron|gamma)")
)

# organism

all_se_list$SE_Broustas_2018_vivo_GSE113509_GPL11202$Organism <- all_se_list$SE_Broustas_2018_vivo_GSE113509_GPL11202$organism_ch1

# sex

all_se_list$SE_Broustas_2018_vivo_GSE113509_GPL11202$Sex <- all_se_list$SE_Broustas_2018_vivo_GSE113509_GPL11202$Sex.ch1

# sample id
all_se_list$SE_Broustas_2018_vivo_GSE113509_GPL11202$Sample_id <- colnames(all_se_list$SE_Broustas_2018_vivo_GSE113509_GPL11202)

# taxonomy id

all_se_list$SE_Broustas_2018_vivo_GSE113509_GPL11202$TaxonomyId <- all_se_list$SE_Broustas_2018_vivo_GSE113509_GPL11202$taxid_ch1 

# experimental setting

all_se_list$SE_Broustas_2018_vivo_GSE113509_GPL11202$Exp_setting <- rep("vivo", 18)


print(all_se_list$SE_Broustas_2018_vivo_GSE113509_GPL11202)

```

### F&G GSE85323

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE85323",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)


colData(all_se_list$SE_Broustas_2017_vivo_GSE85323_GPL10333) |>
  as.data.frame() |>
  head()

# dose

all_se_list$SE_Broustas_2017_vivo_GSE85323_GPL10333$Dose <- ifelse(
  str_detect(all_se_list$SE_Broustas_2017_vivo_GSE85323_GPL10333$protocol.ch1, regex("control", ignore_case = TRUE)), "0Gy",
  str_replace_all(
    str_extract(all_se_list$SE_Broustas_2017_vivo_GSE85323_GPL10333$protocol.ch1, "\\d+(\\.\\d+)?\\s*Gy"), "\\s+", ""
  )
)

# time

all_se_list$SE_Broustas_2017_vivo_GSE85323_GPL10333$Time_point <- str_extract(all_se_list$SE_Broustas_2017_vivo_GSE85323_GPL10333$title, "day\\d+")

# radiation

all_se_list$SE_Broustas_2017_vivo_GSE85323_GPL10333$Radiation_type <- ifelse(
  str_detect(all_se_list$SE_Broustas_2017_vivo_GSE85323_GPL10333$protocol.ch1, regex("control", ignore_case = TRUE)),
  "control",
  str_extract(all_se_list$SE_Broustas_2017_vivo_GSE85323_GPL10333$protocol.ch1, "^(X-ray|Neutron)")
)

# sex

all_se_list$SE_Broustas_2017_vivo_GSE85323_GPL10333$Sex <- all_se_list$SE_Broustas_2017_vivo_GSE85323_GPL10333$gender.ch1

# organism
all_se_list$SE_Broustas_2017_vivo_GSE85323_GPL10333$Organism <- all_se_list$SE_Broustas_2017_vivo_GSE85323_GPL10333$organism_ch1

# sample id
all_se_list$SE_Broustas_2017_vivo_GSE85323_GPL10333$Sample_id <- colnames(all_se_list$SE_Broustas_2017_vivo_GSE85323_GPL10333)

# taxonomy id

all_se_list$SE_Broustas_2017_vivo_GSE85323_GPL10333$TaxonomyId <- all_se_list$SE_Broustas_2017_vivo_GSE85323_GPL10333$taxid_ch1 

# experimental setting

all_se_list$SE_Broustas_2017_vivo_GSE85323_GPL10333$Exp_setting <- rep("vivo", 72)


print(all_se_list$SE_Broustas_2017_vivo_GSE85323_GPL10333)

```

### F&G GSE90909

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE90909",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)

colData(all_se_list$SE_Broustas_2017_vitro_GSE90909_GPL13497) |>
  as.data.frame() |>
  head()

# there is no info about sex here

# dose

all_se_list$SE_Broustas_2017_vitro_GSE90909_GPL13497$Dose <- ifelse(
  str_detect(all_se_list$SE_Broustas_2017_vitro_GSE90909_GPL13497$title, regex("control", ignore_case = TRUE)),
  "0Gy",
  str_extract(all_se_list$SE_Broustas_2017_vitro_GSE90909_GPL13497$title, "\\d+(\\.\\d+)?Gy")
)

# time

all_se_list$SE_Broustas_2017_vitro_GSE90909_GPL13497$Time_point <- rep("24h", 92)

# radiation

all_se_list$SE_Broustas_2017_vitro_GSE90909_GPL13497$Radiation_type <- ifelse(
  str_detect(all_se_list$SE_Broustas_2017_vitro_GSE90909_GPL13497$title, regex("control", ignore_case = TRUE)),
  "control",
  str_extract(all_se_list$SE_Broustas_2017_vitro_GSE90909_GPL13497$title, "(?i)(X-ray|Neutron)")
)

# Organism

all_se_list$SE_Broustas_2017_vitro_GSE90909_GPL13497$Organism <- all_se_list$SE_Broustas_2017_vitro_GSE90909_GPL13497$organism_ch1

# sample id

all_se_list$SE_Broustas_2017_vitro_GSE90909_GPL13497$Sample_id <- colnames(all_se_list$SE_Broustas_2017_vitro_GSE90909_GPL13497)

# taxonomy id

all_se_list$SE_Broustas_2017_vitro_GSE90909_GPL13497$TaxonomyId <- all_se_list$SE_Broustas_2017_vitro_GSE90909_GPL13497$taxid_ch1 

# experimental setting

all_se_list$SE_Broustas_2017_vitro_GSE90909_GPL13497$Exp_setting <- rep("vitro", 92)


print(all_se_list$SE_Broustas_2017_vitro_GSE90909_GPL13497)

```

## F&G se for X-ray studies
### F&G GSE23393

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE23393",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)


colData(all_se_list$SE_Paul_2010_vivo_GSE23393_GPL6480) |>
  as.data.frame() |>
  head()

# dose ... there is a space between the value and the unite

all_se_list$SE_Paul_2010_vivo_GSE23393_GPL6480$Dose <- str_extract(
  all_se_list$SE_Paul_2010_vivo_GSE23393_GPL6480$source_name_ch1,
  "\\d+(\\.\\d+)?\\s*Gy"
)

# time

all_se_list$SE_Paul_2010_vivo_GSE23393_GPL6480$Time_point <- rep("4hr", 16)

# radiation

all_se_list$SE_Paul_2010_vivo_GSE23393_GPL6480$Radiation_type <- rep("X-ray", 16)

# sex

all_se_list$SE_Paul_2010_vivo_GSE23393_GPL6480$Sex <- all_se_list$SE_Paul_2010_vivo_GSE23393_GPL6480$gender.ch1

# age
all_se_list$SE_Paul_2010_vivo_GSE23393_GPL6480$Age <- all_se_list$SE_Paul_2010_vivo_GSE23393_GPL6480$age.ch1

# organism
all_se_list$SE_Paul_2010_vivo_GSE23393_GPL6480$Organism <- all_se_list$SE_Paul_2010_vivo_GSE23393_GPL6480$organism_ch1

# sample id
all_se_list$SE_Paul_2010_vivo_GSE23393_GPL6480$Sample_id <- colnames(all_se_list$SE_Paul_2010_vivo_GSE23393_GPL6480)

# taxonomy id

all_se_list$SE_Paul_2010_vivo_GSE23393_GPL6480$TaxonomyId <- all_se_list$SE_Paul_2010_vivo_GSE23393_GPL6480$taxid_ch1 

# experimental setting

all_se_list$SE_Paul_2010_vivo_GSE23393_GPL6480$Exp_setting <- rep("vivo", 16)


print(all_se_list$SE_Paul_2010_vivo_GSE23393_GPL6480)

```

### F&G GSE65292

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE65292",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)

colData(all_se_list$SE_Ghandhi_2015_vitro_GSE65292_GPL13497) |>
  as.data.frame() |>
  head()

# dose

all_se_list$SE_Ghandhi_2015_vitro_GSE65292_GPL13497$Dose <- all_se_list$SE_Ghandhi_2015_vitro_GSE65292_GPL13497$dose.ch1

# time

all_se_list$SE_Ghandhi_2015_vitro_GSE65292_GPL13497$Time_point <- rep("24hr", 35)

# radiation

all_se_list$SE_Ghandhi_2015_vitro_GSE65292_GPL13497$Radiation_type <- rep("X-ray", 35)

# sex--- not provided

# dose rate
all_se_list$SE_Ghandhi_2015_vitro_GSE65292_GPL13497$Dose_rate <- all_se_list$SE_Ghandhi_2015_vitro_GSE65292_GPL13497$dose.rate.ch1

# organism

all_se_list$SE_Ghandhi_2015_vitro_GSE65292_GPL13497$Organism <- all_se_list$SE_Ghandhi_2015_vitro_GSE65292_GPL13497$organism_ch1

# sample id
all_se_list$SE_Ghandhi_2015_vitro_GSE65292_GPL13497$Sample_id <- colnames(all_se_list$SE_Ghandhi_2015_vitro_GSE65292_GPL13497)

# taxonomy id

all_se_list$SE_Ghandhi_2015_vitro_GSE65292_GPL13497$TaxonomyId <- all_se_list$SE_Ghandhi_2015_vitro_GSE65292_GPL13497$taxid_ch1 

# experimental setting

all_se_list$SE_Ghandhi_2015_vitro_GSE65292_GPL13497$Exp_setting <- rep("vitro", 35)


print(all_se_list$SE_Ghandhi_2015_vitro_GSE65292_GPL13497)

```

### F&G GSE15341

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE15341",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)

# keep it for later.. information are not too clear in regards to vivo/vitro conditions and also time post exposure if in vitro

colData(all_se_list$SE_Flores_2009_vitro_GSE15341_GPL8332) |>
  as.data.frame() |>
  head()

all_se_list$SE_Flores_2009_vitro_GSE15341_GPL8332$Dose <- if_else(
  str_detect(all_se_list$SE_Flores_2009_vitro_GSE15341_GPL8332$protocol.ch1, "non-radiated"),
  "0Gy",
  str_extract(all_se_list$SE_Flores_2009_vitro_GSE15341_GPL8332$protocol.ch1, "\\d+(\\.\\d+)?Gy")
)
```

### F&G GSE20162

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE20162",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)

colData(all_se_list$SE_Amundson_2011_vivo_GSE20162_GPL6480) |>
  as.data.frame() |>
  head()

# dose

all_se_list$SE_Amundson_2011_vivo_GSE20162_GPL6480$Dose <- if_else(
  str_detect(all_se_list$SE_Amundson_2011_vivo_GSE20162_GPL6480$treatment.group.ch1, "Gy"),
  str_extract(all_se_list$SE_Amundson_2011_vivo_GSE20162_GPL6480$treatment.group.ch1, "\\d+(\\.\\d+)?Gy"),
  "0Gy"
)

# time

all_se_list$SE_Amundson_2011_vivo_GSE20162_GPL6480$Time_point <- if_else(
  str_detect(all_se_list$SE_Amundson_2011_vivo_GSE20162_GPL6480$treatment.group.ch1, "\\d+hr"),
  str_extract(all_se_list$SE_Amundson_2011_vivo_GSE20162_GPL6480$treatment.group.ch1, "\\d+hr"),
  "0hr"
)

# radiation

all_se_list$SE_Amundson_2011_vivo_GSE20162_GPL6480$Radiation_type <- rep("X-ray", 66)

# sex

all_se_list$SE_Amundson_2011_vivo_GSE20162_GPL6480$Sex <- all_se_list$SE_Amundson_2011_vivo_GSE20162_GPL6480$gender.ch1

# organism
all_se_list$SE_Amundson_2011_vivo_GSE20162_GPL6480$Organism <- all_se_list$SE_Amundson_2011_vivo_GSE20162_GPL6480$organism_ch1

# age
all_se_list$SE_Amundson_2011_vivo_GSE20162_GPL6480$Age <- all_se_list$SE_Amundson_2011_vivo_GSE20162_GPL6480$age.ch1

# status

all_se_list$SE_Amundson_2011_vivo_GSE20162_GPL6480$Disease_status <- ifelse(
  str_detect(all_se_list$SE_Amundson_2011_vivo_GSE20162_GPL6480$disease.status.ch1, regex("healthy", ignore_case = TRUE)),
  "healthy",
  "patient"
)

# sample id
all_se_list$SE_Amundson_2011_vivo_GSE20162_GPL6480$Sample_id <- colnames(all_se_list$SE_Amundson_2011_vivo_GSE20162_GPL6480)

# taxonomy id

all_se_list$SE_Amundson_2011_vivo_GSE20162_GPL6480$TaxonomyId <- all_se_list$SE_Amundson_2011_vivo_GSE20162_GPL6480$taxid_ch1 

# experimental setting

all_se_list$SE_Amundson_2011_vivo_GSE20162_GPL6480$Exp_setting <- rep("vivo", 66)


print(all_se_list$SE_Amundson_2011_vivo_GSE20162_GPL6480)

```

### F&G GSE196400

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE196400",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)

colData(all_se_list$SE_Broustas_2023_vivo_GSE196400_GPL11202) |>
  as.data.frame() |>
  head()

# dose

all_se_list$SE_Broustas_2023_vivo_GSE196400_GPL11202$Dose <- ifelse(
  str_detect(all_se_list$SE_Broustas_2023_vivo_GSE196400_GPL11202$protocol.ch1, regex("0Gy", ignore_case = TRUE)),
  "0Gy",
  str_extract(all_se_list$SE_Broustas_2023_vivo_GSE196400_GPL11202$protocol.ch1, "\\d+(\\.\\d+)?\\s*Gy")
)


# time

all_se_list$SE_Broustas_2023_vivo_GSE196400_GPL11202$Time_point <- rep("24hr", 24)

# radiation

all_se_list$SE_Broustas_2023_vivo_GSE196400_GPL11202$Radiation_type <- rep("X-ray", 24)

# sex
all_se_list$SE_Broustas_2023_vivo_GSE196400_GPL11202$Sex <- all_se_list$SE_Broustas_2023_vivo_GSE196400_GPL11202$Sex.ch1

# genotype

all_se_list$SE_Broustas_2023_vivo_GSE196400_GPL11202$Genotype <- all_se_list$SE_Broustas_2023_vivo_GSE196400_GPL11202$genotype.ch1
# organism
all_se_list$SE_Broustas_2023_vivo_GSE196400_GPL11202$Organism <- all_se_list$SE_Broustas_2023_vivo_GSE196400_GPL11202$organism_ch1

# sample id
all_se_list$SE_Broustas_2023_vivo_GSE196400_GPL11202$Sample_id <- colnames(all_se_list$SE_Broustas_2023_vivo_GSE196400_GPL11202)

# taxonomy id

all_se_list$SE_Broustas_2023_vivo_GSE196400_GPL11202$TaxonomyId <- all_se_list$SE_Broustas_2023_vivo_GSE196400_GPL11202$taxid_ch1 

# experimental setting

all_se_list$SE_Broustas_2023_vivo_GSE196400_GPL11202$Exp_setting <- rep("vivo", 24)


print(all_se_list$SE_Broustas_2023_vivo_GSE196400_GPL11202)
```

### F&G GSE184361

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE184361",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)

colData(all_se_list$SE_Broustas_2022_vivo_GSE184361_GPL11202) |>
  as.data.frame() |>
  head()

# dose
all_se_list$SE_Broustas_2022_vivo_GSE184361_GPL11202$Dose <- rep(c(rep("0Gy", 5), rep("7Gy", 5)), 3)

# time

all_se_list$SE_Broustas_2022_vivo_GSE184361_GPL11202$Time_point <- rep("24hr", 30)

# radiation
all_se_list$SE_Broustas_2022_vivo_GSE184361_GPL11202$Radiation_type <- rep("X-ray", 30)

# sex

all_se_list$SE_Broustas_2022_vivo_GSE184361_GPL11202$Sex <- all_se_list$SE_Broustas_2022_vivo_GSE184361_GPL11202$Sex.ch1

# organism

all_se_list$SE_Broustas_2022_vivo_GSE184361_GPL11202$Organism <- all_se_list$SE_Broustas_2022_vivo_GSE184361_GPL11202$organism_ch1

# genotype
all_se_list$SE_Broustas_2022_vivo_GSE184361_GPL11202$Genotype <- str_extract(all_se_list$SE_Broustas_2022_vivo_GSE184361_GPL11202$title, "p38_(dki|dn|wt)")

all_se_list$SE_Broustas_2022_vivo_GSE184361_GPL11202$Genotype <- recode(all_se_list$SE_Broustas_2022_vivo_GSE184361_GPL11202$Genotype,
  "p38_dki" = "p38_double_knockout",
  "p38_dn"  = "p38_dominant_negative_mutation",
  "p38_wt"  = "p38_wild_type"
)

# sample id
all_se_list$SE_Broustas_2022_vivo_GSE184361_GPL11202$Sample_id <- colnames(all_se_list$SE_Broustas_2022_vivo_GSE184361_GPL11202)

# taxonomy id

all_se_list$SE_Broustas_2022_vivo_GSE184361_GPL11202$TaxonomyId <- all_se_list$SE_Broustas_2022_vivo_GSE184361_GPL11202$taxid_ch1 

# experimental setting

all_se_list$SE_Broustas_2022_vivo_GSE184361_GPL11202$Exp_setting <- rep("vivo", 30)


print(all_se_list$SE_Broustas_2022_vivo_GSE184361_GPL11202)

```

### F&G GSE132559

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE132559",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)


colData(all_se_list$SE_Broustas_2021_vivo_GSE132559_GPL11202) |>
  as.data.frame() |>
  head()

# dose

all_se_list$SE_Broustas_2021_vivo_GSE132559_GPL11202$Dose <- ifelse(
  grepl("Unirradiated", all_se_list$SE_Broustas_2021_vivo_GSE132559_GPL11202$title, ignore.case = TRUE),
  "0Gy",
  "4Gy"
)

# time

all_se_list$SE_Broustas_2021_vivo_GSE132559_GPL11202$Time_point <- rep("24hr", 24)
# radiation

all_se_list$SE_Broustas_2021_vivo_GSE132559_GPL11202$Radiation_type <- rep("X-ray", 24)

# age

all_se_list$SE_Broustas_2021_vivo_GSE132559_GPL11202$Age <- dplyr::case_when(
  grepl("Young", all_se_list$SE_Broustas_2021_vivo_GSE132559_GPL11202$title, ignore.case = TRUE) ~ "2 months",
  grepl("Old", all_se_list$SE_Broustas_2021_vivo_GSE132559_GPL11202$title, ignore.case = TRUE) ~ "21 months",
  TRUE ~ NA_character_
)

# sex
all_se_list$SE_Broustas_2021_vivo_GSE132559_GPL11202$Sex <- all_se_list$SE_Broustas_2021_vivo_GSE132559_GPL11202$gender.ch1

# organism
all_se_list$SE_Broustas_2021_vivo_GSE132559_GPL11202$Organism <- all_se_list$SE_Broustas_2021_vivo_GSE132559_GPL11202$organism_ch1

# sample id
all_se_list$SE_Broustas_2021_vivo_GSE132559_GPL11202$Sample_id <- colnames(all_se_list$SE_Broustas_2021_vivo_GSE132559_GPL11202)

# taxonomy id

all_se_list$SE_Broustas_2021_vivo_GSE132559_GPL11202$TaxonomyId <- all_se_list$SE_Broustas_2021_vivo_GSE132559_GPL11202$taxid_ch1 

# experimental setting

all_se_list$SE_Broustas_2021_vivo_GSE132559_GPL11202$Exp_setting <- rep("vivo", 24)

print(all_se_list$SE_Broustas_2021_vivo_GSE132559_GPL11202)

```

### F&G GSE137192

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE137192",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)


colData(all_se_list$SE_Yamaguchi_2020_vivo_GSE137192_GPL1261) |>
  as.data.frame() |>
  head()


all_se_list$SE_Yamaguchi_2020_vivo_GSE137192_GPL1261$Dose <- if_else(
  str_detect(all_se_list$SE_Yamaguchi_2020_vivo_GSE137192_GPL1261$treatment.ch1, regex("control", ignore_case = TRUE)),
  "0Gy",
  str_remove_all(str_extract(all_se_list$SE_Yamaguchi_2020_vivo_GSE137192_GPL1261$treatment.ch1, "\\d+(\\.\\d+)?\\s*Gy"), "\\s+")
)

# time

all_se_list$SE_Yamaguchi_2020_vivo_GSE137192_GPL1261$Time_point <- rep("24hr", 17)

# radiation
all_se_list$SE_Yamaguchi_2020_vivo_GSE137192_GPL1261$Radiation_type <- rep("X-ray", 17)

# sex
all_se_list$SE_Yamaguchi_2020_vivo_GSE137192_GPL1261$Sex <- all_se_list$SE_Yamaguchi_2020_vivo_GSE137192_GPL1261$gender.ch1

# organism
all_se_list$SE_Yamaguchi_2020_vivo_GSE137192_GPL1261$Organism <- all_se_list$SE_Yamaguchi_2020_vivo_GSE137192_GPL1261$organism_ch1

# sample id
all_se_list$SE_Yamaguchi_2020_vivo_GSE137192_GPL1261$Sample_id <- colnames(all_se_list$SE_Yamaguchi_2020_vivo_GSE137192_GPL1261)

# taxonomy id

all_se_list$SE_Yamaguchi_2020_vivo_GSE137192_GPL1261$TaxonomyId <- all_se_list$SE_Yamaguchi_2020_vivo_GSE137192_GPL1261$taxid_ch1 

# experimental setting

all_se_list$SE_Yamaguchi_2020_vivo_GSE137192_GPL1261$Exp_setting <- rep("vivo", 17)


print(all_se_list$SE_Yamaguchi_2020_vivo_GSE137192_GPL1261)

```

### F&G GSE114142

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE114142",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)

colData(all_se_list$SE_Mukherjee_2019_vivo_GSE114142_GPL11202) |>
  as.data.frame() |>
  head()

# dose

all_se_list$SE_Mukherjee_2019_vivo_GSE114142_GPL11202$Dose <- str_replace_all(str_extract(all_se_list$SE_Mukherjee_2019_vivo_GSE114142_GPL11202$title, "\\d+\\s*Gy"), "\\s+", "")

# time

all_se_list$SE_Mukherjee_2019_vivo_GSE114142_GPL11202$Time_point <- rep("24hr", 20)

# radiation
all_se_list$SE_Mukherjee_2019_vivo_GSE114142_GPL11202$Radiation_type <- rep("X-ray", 20)

# sex

all_se_list$SE_Mukherjee_2019_vivo_GSE114142_GPL11202$Sex <- all_se_list$SE_Mukherjee_2019_vivo_GSE114142_GPL11202$gender.ch1

# organism

all_se_list$SE_Mukherjee_2019_vivo_GSE114142_GPL11202$Organism <- all_se_list$SE_Mukherjee_2019_vivo_GSE114142_GPL11202$organism_ch1

# genotype

all_se_list$SE_Mukherjee_2019_vivo_GSE114142_GPL11202$Genotype <- str_extract(all_se_list$SE_Mukherjee_2019_vivo_GSE114142_GPL11202$title, "WT|Il10-/-")

# sample id

all_se_list$SE_Mukherjee_2019_vivo_GSE114142_GPL11202$Sample_id <- colnames(all_se_list$SE_Mukherjee_2019_vivo_GSE114142_GPL11202)

# taxonomy id

all_se_list$SE_Mukherjee_2019_vivo_GSE114142_GPL11202$TaxonomyId <- all_se_list$SE_Mukherjee_2019_vivo_GSE114142_GPL11202$taxid_ch1 

# experimental setting

all_se_list$SE_Mukherjee_2019_vivo_GSE114142_GPL11202$Exp_setting <- rep("vivo", 20)


print(all_se_list$SE_Mukherjee_2019_vivo_GSE114142_GPL11202)

```

### F&G GSE101402

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE101402",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)


colData(all_se_list$SE_Amundson_2018_vivo_GSE101402_GPL11202) |>
  as.data.frame() |>
  head()

# dose

all_se_list$SE_Amundson_2018_vivo_GSE101402_GPL11202$Dose <- paste0(all_se_list$SE_Amundson_2018_vivo_GSE101402_GPL11202$x.ray.dose..gy..ch1, "Gy")


# time

all_se_list$SE_Amundson_2018_vivo_GSE101402_GPL11202$Time_point <- rep("24hr", 24)

# radiation
all_se_list$SE_Amundson_2018_vivo_GSE101402_GPL11202$Radiation_type <- rep("X-ray", 24)

# genotype
all_se_list$SE_Amundson_2018_vivo_GSE101402_GPL11202$Genotype <- all_se_list$SE_Amundson_2018_vivo_GSE101402_GPL11202$genotype.ch1

# sex
all_se_list$SE_Amundson_2018_vivo_GSE101402_GPL11202$Sex <- all_se_list$SE_Amundson_2018_vivo_GSE101402_GPL11202$Sex.ch1

# organism

all_se_list$SE_Amundson_2018_vivo_GSE101402_GPL11202$Organism <- all_se_list$SE_Amundson_2018_vivo_GSE101402_GPL11202$organism_ch1

# sample id
all_se_list$SE_Amundson_2018_vivo_GSE101402_GPL11202$Sample_id <- colnames(all_se_list$SE_Amundson_2018_vivo_GSE101402_GPL11202)

# taxonomy id

all_se_list$SE_Amundson_2018_vivo_GSE101402_GPL11202$TaxonomyId <- all_se_list$SE_Amundson_2018_vivo_GSE101402_GPL11202$taxid_ch1 

# experimental setting

all_se_list$SE_Amundson_2018_vivo_GSE101402_GPL11202$Exp_setting <- rep("vivo", 24)


print(all_se_list$SE_Amundson_2018_vivo_GSE101402_GPL11202)
```

### F&G GSE99176

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE99176",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)

colData(all_se_list$SE_Amundson_2018_vivo_GSE99176_GPL11202) |>
  as.data.frame() |>
  head()

# dose

all_se_list$SE_Amundson_2018_vivo_GSE99176_GPL11202$Dose <- paste0(all_se_list$SE_Amundson_2018_vivo_GSE99176_GPL11202$x.ray.dose..gy..ch1, "Gy")


# time

all_se_list$SE_Amundson_2018_vivo_GSE99176_GPL11202$Time_point <- rep("24hr", 32)

# radiation
all_se_list$SE_Amundson_2018_vivo_GSE99176_GPL11202$Radiation_type <- rep("X-ray", 32)

# genotype

all_se_list$SE_Amundson_2018_vivo_GSE99176_GPL11202$Genotype <- all_se_list$SE_Amundson_2018_vivo_GSE99176_GPL11202$genotype.ch1

# sex
all_se_list$SE_Amundson_2018_vivo_GSE99176_GPL11202$Sex <- all_se_list$SE_Amundson_2018_vivo_GSE99176_GPL11202$Sex.ch1

# organism

all_se_list$SE_Amundson_2018_vivo_GSE99176_GPL11202$Organism <- all_se_list$SE_Amundson_2018_vivo_GSE99176_GPL11202$organism_ch1

# sample id
all_se_list$SE_Amundson_2018_vivo_GSE99176_GPL11202$Sample_id <- colnames(all_se_list$SE_Amundson_2018_vivo_GSE99176_GPL11202)

# taxonomy id

all_se_list$SE_Amundson_2018_vivo_GSE99176_GPL11202$TaxonomyId <- all_se_list$SE_Amundson_2018_vivo_GSE99176_GPL11202$taxid_ch1 

# experimental setting

all_se_list$SE_Amundson_2018_vivo_GSE99176_GPL11202$Exp_setting <- rep("vivo", 32)


print(all_se_list$SE_Amundson_2018_vivo_GSE99176_GPL11202)

```

### F&G GSE62623

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE62623",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)

colData(all_se_list$SE_Paul_2015_vivo_GSE62623_GPL10333) |>
  as.data.frame() |>
  head()

# dose

all_se_list$SE_Paul_2015_vivo_GSE62623_GPL10333$Dose <- ifelse(
  grepl("unirradiated", all_se_list$SE_Paul_2015_vivo_GSE62623_GPL10333$treatment.ch1, ignore.case = TRUE),
  "0Gy",
  stringr::str_extract(all_se_list$SE_Paul_2015_vivo_GSE62623_GPL10333$treatment.ch1, "\\d+(\\.\\d+)?Gy")
)

# time
all_se_list$SE_Paul_2015_vivo_GSE62623_GPL10333$Time_point <- rep("24hr", 48)

# radiation
all_se_list$SE_Paul_2015_vivo_GSE62623_GPL10333$Radiation_type <- rep("X-ray", 48)

# dose rate
all_se_list$SE_Paul_2015_vivo_GSE62623_GPL10333$Dose_rate <- ifelse(
  grepl("unirradiated", all_se_list$SE_Paul_2015_vivo_GSE62623_GPL10333$treatment.ch1, ignore.case = TRUE),
  "Control",
  stringr::str_extract(all_se_list$SE_Paul_2015_vivo_GSE62623_GPL10333$treatment.ch1, "(low|high)-dose-rate")
)

# sex

all_se_list$SE_Paul_2015_vivo_GSE62623_GPL10333$Sex <- all_se_list$SE_Paul_2015_vivo_GSE62623_GPL10333$Sex.ch1

# organism
all_se_list$SE_Paul_2015_vivo_GSE62623_GPL10333$Organism <- all_se_list$SE_Paul_2015_vivo_GSE62623_GPL10333$organism_ch1

# sample id

all_se_list$SE_Paul_2015_vivo_GSE62623_GPL10333$Sample_id <- colnames(all_se_list$SE_Paul_2015_vivo_GSE62623_GPL10333)

# taxonomy id

all_se_list$SE_Paul_2015_vivo_GSE62623_GPL10333$TaxonomyId <- all_se_list$SE_Paul_2015_vivo_GSE62623_GPL10333$taxid_ch1 

# experimental setting

all_se_list$SE_Paul_2015_vivo_GSE62623_GPL10333$Exp_setting <- rep("vivo", 48)


print(all_se_list$SE_Paul_2015_vivo_GSE62623_GPL10333)

```

### F&G GSE84898

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE84898",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)

colData(all_se_list$SE_Ghandhi_2018_vivo_GSE84898_GPL13497) |>
  as.data.frame() |>
  head()


# dose

all_se_list$SE_Ghandhi_2018_vivo_GSE84898_GPL13497$Dose <- c(rep("0Gy", 5), rep("10.1Gy", 15))

# time

all_se_list$SE_Ghandhi_2018_vivo_GSE84898_GPL13497$Time_point <- rep(c("pre-irradiation", "2 days", "5 days", "30 days"), each = 5)

# radiation

all_se_list$SE_Ghandhi_2018_vivo_GSE84898_GPL13497$Radiation_type <- rep("X-ray", 20)

# sex

all_se_list$SE_Ghandhi_2018_vivo_GSE84898_GPL13497$Sex <- rep("male", 20)

# organism
all_se_list$SE_Ghandhi_2018_vivo_GSE84898_GPL13497$Organism <- all_se_list$SE_Ghandhi_2018_vivo_GSE84898_GPL13497$organism_ch1

# sample id

all_se_list$SE_Ghandhi_2018_vivo_GSE84898_GPL13497$Sample_id <- colnames(all_se_list$SE_Ghandhi_2018_vivo_GSE84898_GPL13497)

# taxonomy id

all_se_list$SE_Ghandhi_2018_vivo_GSE84898_GPL13497$TaxonomyId <- all_se_list$SE_Ghandhi_2018_vivo_GSE84898_GPL13497$taxid_ch1 

# experimental setting

all_se_list$SE_Ghandhi_2018_vivo_GSE84898_GPL13497$Exp_setting <- rep("vivo", 20)


print(all_se_list$SE_Ghandhi_2018_vivo_GSE84898_GPL13497)

```

### F&G GSE133451

```{r}
all_se_list <- process_geo_dataset(
  accession_id = "GSE133451",
  excel_path = "inst/extdata/Curated_datasets.xlsx",
  all_se_list
)

colData(all_se_list$SE_Broustas_2021_vivo_GSE133451_GPL11202) |>
  as.data.frame() |>
  head()


# dose

all_se_list$SE_Broustas_2021_vivo_GSE133451_GPL11202$Dose <- dplyr::recode(all_se_list$SE_Broustas_2021_vivo_GSE133451_GPL11202$treatment.ch1,
  "UnIrradiated" = "0Gy",
  "Irradiated" = "4Gy"
)
# time

all_se_list$SE_Broustas_2021_vivo_GSE133451_GPL11202$Time_point <- rep("24hr", 20)

# radiation

all_se_list$SE_Broustas_2021_vivo_GSE133451_GPL11202$Radiation_type <- rep("X-ray", 20)


# age

all_se_list$SE_Broustas_2021_vivo_GSE133451_GPL11202$Age <- dplyr::case_when(
  grepl("Young", all_se_list$SE_Broustas_2021_vivo_GSE133451_GPL11202$age.ch1, ignore.case = TRUE) ~ "2 months",
  grepl("Old", all_se_list$SE_Broustas_2021_vivo_GSE133451_GPL11202$age.ch1, ignore.case = TRUE) ~ "24 months",
  TRUE ~ NA_character_
)

# sex

all_se_list$SE_Broustas_2021_vivo_GSE133451_GPL11202$Sex <- all_se_list$SE_Broustas_2021_vivo_GSE133451_GPL11202$gender.ch1

# organism
all_se_list$SE_Broustas_2021_vivo_GSE133451_GPL11202$Organism <- all_se_list$SE_Broustas_2021_vivo_GSE133451_GPL11202$organism_ch1

# sample id

all_se_list$SE_Broustas_2021_vivo_GSE133451_GPL11202$Sample_id <- colnames(all_se_list$SE_Broustas_2021_vivo_GSE133451_GPL11202)

# taxonomy id

all_se_list$SE_Broustas_2021_vivo_GSE133451_GPL11202$TaxonomyId <- all_se_list$SE_Broustas_2021_vivo_GSE133451_GPL11202$taxid_ch1 

# experimental setting

all_se_list$SE_Broustas_2021_vivo_GSE133451_GPL11202$Exp_setting <- rep("vivo", 20)


print(all_se_list$SE_Broustas_2021_vivo_GSE133451_GPL11202)

```

# Loading Salah_2025 dataset

This dataset is publicly available on GitHub -> "https://github.com/AhmedSAHassan/Phybion_ShortReads_Analysis"

You can fetch this dataset using the following terminal command
"curl -L -o gse_PhyBioN_Pseudonymized.RDS https://github.com/AhmedSAHassan/Phybion_ShortReads_Analysis/raw/main/PhyBioN_SR_Analysis/gse_PhyBioN_Pseudonymized.RDS"

Or using R code

 download.file(
   url = "https://github.com/AhmedSAHassan/Phybion_ShortReads_Analysis/raw/main/PhyBioN_SR_Analysis/gse_PhyBioN_Pseudonymized.RDS",
   destfile = "gse_PhyBioN_Pseudonymized.RDS",
   mode = "wb"
 )
 
TODOAHMED - carefull, here you load the GSE and then you expect that the SE is somewhere already?  

```{r}

# Loading the dataset locally

SE_Salah_2025_vitro<- readRDS("DoReMiTra/SE/SE_Salah_2025_vitro.RDS")

# convert gencode id to ensemble id

SE_Salah_2025_vitro <- dds_gencode_to_ensembl(SE_Salah_2025_vitro)

# For gene symbols with more than 1 ensemble id, we pick the one with higher variability. also we removed the ensemble id with no matching gene symbols

SE_Salah_2025_vitro <- collapse_by_symbol_variance(SE_Salah_2025_vitro, symbol_col = "SYMBOL")

# adding radiation type

SE_Salah_2025_vitro$Radiation_type <- rep("X-ray", 30)

# adding organism

SE_Salah_2025_vitro$Organism <- rep("Homo sapiens", 30)

# taxonomy id

SE_Salah_2025_vitro$TaxonomyId <- rep("9606", 30)

# experimental setting

SE_Salah_2025_vitro$Exp_setting <- rep("vitro", 30)

# remove unnecessary columns in the coldata

colData(SE_Salah_2025_vitro) <- colData(SE_Salah_2025_vitro)[,- c(1,2,3,4,10,11,12)]

# adding it to the se list

all_se_list[["SE_Salah_2025_vitro"]] <- SE_Salah_2025_vitro


print(SE_Salah_2025_vitro)

```

# Saving summarized experiment RDS objects

```{r}
save_se_objects(all_se_list, output_dir = "./DoReMiTra/SE", 
                save_se_obj = TRUE, save_se_components = FALSE)
```

# Session info {-}

```{r}
sessionInfo()
```
